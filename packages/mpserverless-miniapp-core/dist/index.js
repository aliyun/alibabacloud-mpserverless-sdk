!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@alicloud/mp-db-service"),require("@alicloud/mp-file-service"),require("@alicloud/mp-function-service"),require("@alicloud/mp-proxy-service"),require("@alicloud/mp-user-service"),require("@alicloud/mpserverless-core")):"function"==typeof define&&define.amd?define(["@alicloud/mp-db-service","@alicloud/mp-file-service","@alicloud/mp-function-service","@alicloud/mp-proxy-service","@alicloud/mp-user-service","@alicloud/mpserverless-core"],t):"object"==typeof exports?exports["@alicloud/mpserverless-miniapp-core"]=t(require("@alicloud/mp-db-service"),require("@alicloud/mp-file-service"),require("@alicloud/mp-function-service"),require("@alicloud/mp-proxy-service"),require("@alicloud/mp-user-service"),require("@alicloud/mpserverless-core")):e["@alicloud/mpserverless-miniapp-core"]=t(e["@alicloud/mp-db-service"],e["@alicloud/mp-file-service"],e["@alicloud/mp-function-service"],e["@alicloud/mp-proxy-service"],e["@alicloud/mp-user-service"],e["@alicloud/mpserverless-core"])}(this,(function(e,t,r,n,o,i){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};e[n].call(o.exports,o,o.exports,r);o.l=!0;return o.exports}r.m=e;r.c=t;r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})};r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:!0})};r.t=function(e,t){1&t&&(e=r(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);r.r(n);Object.defineProperty(n,"default",{enumerable:!0,value:e});if(2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n};r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};r.d(t,"a",t);return t};r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};r.p="";return r(r.s="./src/index.ts")}({"../../node_modules/crypto-js/core.js":function(e,t,r){e.exports=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;e.prototype=t;r=new e;e.prototype=null;return r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);e&&t.mixIn(e);t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)});t.init.prototype=t;t.$super=this;return t},create:function(){var e=this.extend();e.init.apply(e,arguments);return e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[];this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;this.clamp();if(n%4)for(var i=0;i<o;i++){var c=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=c<<24-(n+i)%4*8}else for(i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];this.sigBytes+=o;return this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8;t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);e.words=this.words.slice(0);return e},random:function(t){for(var r,n=[],o=function(t){t=t;var r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;o/=4294967296;return(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var u=o(4294967296*(r||e.random()));r=987654071*u();n.push(4294967296*u()|0)}return new c.init(n,t)}}),u=n.enc={},s=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16));n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},a=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},f=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(a.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return a.parse(unescape(encodeURIComponent(e)))}},l=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new c.init;this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e));this._data.concat(e);this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,u=o/(4*i),s=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*i,a=e.min(4*s,o);if(s){for(var f=0;f<s;f+=i)this._doProcessBlock(n,f);var l=n.splice(0,s);r.sigBytes-=a}return new c.init(l,a)},clone:function(){var e=i.clone.call(this);e._data=this._data.clone();return e},_minBufferSize:0}),p=(o.Hasher=l.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e);this.reset()},reset:function(){l.reset.call(this);this._doReset()},update:function(e){this._append(e);this._process();return this},finalize:function(e){e&&this._append(e);return this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math);return e}()},"../../node_modules/crypto-js/hmac-md5.js":function(e,t,r){e.exports=function(e){return e.HmacMD5}(r("../../node_modules/crypto-js/core.js"),r("../../node_modules/crypto-js/md5.js"),r("../../node_modules/crypto-js/hmac.js"))},"../../node_modules/crypto-js/hmac.js":function(e,t,r){e.exports=function(e){!function(){var t=e,r=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init;"string"==typeof t&&(t=n.parse(t));var r=e.blockSize,o=4*r;t.sigBytes>o&&(t=e.finalize(t));t.clamp();for(var i=this._oKey=t.clone(),c=this._iKey=t.clone(),u=i.words,s=c.words,a=0;a<r;a++){u[a]^=1549556828;s[a]^=909522486}i.sigBytes=c.sigBytes=o;this.reset()},reset:function(){var e=this._hasher;e.reset();e.update(this._iKey)},update:function(e){this._hasher.update(e);return this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();return t.finalize(this._oKey.clone().concat(r))}})}()}(r("../../node_modules/crypto-js/core.js"))},"../../node_modules/crypto-js/md5.js":function(e,t,r){e.exports=function(e){!function(t){var r=e,n=r.lib,o=n.WordArray,i=n.Hasher,c=r.algo,u=[];!function(){for(var e=0;e<64;e++)u[e]=4294967296*t.abs(t.sin(e+1))|0}();var s=c.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,c=e[t+0],s=e[t+1],d=e[t+2],y=e[t+3],h=e[t+4],v=e[t+5],b=e[t+6],m=e[t+7],g=e[t+8],O=e[t+9],w=e[t+10],j=e[t+11],S=e[t+12],_=e[t+13],P=e[t+14],x=e[t+15],R=i[0],E=i[1],I=i[2],k=i[3];R=a(R,E,I,k,c,7,u[0]);k=a(k,R,E,I,s,12,u[1]);I=a(I,k,R,E,d,17,u[2]);E=a(E,I,k,R,y,22,u[3]);R=a(R,E,I,k,h,7,u[4]);k=a(k,R,E,I,v,12,u[5]);I=a(I,k,R,E,b,17,u[6]);E=a(E,I,k,R,m,22,u[7]);R=a(R,E,I,k,g,7,u[8]);k=a(k,R,E,I,O,12,u[9]);I=a(I,k,R,E,w,17,u[10]);E=a(E,I,k,R,j,22,u[11]);R=a(R,E,I,k,S,7,u[12]);k=a(k,R,E,I,_,12,u[13]);I=a(I,k,R,E,P,17,u[14]);R=f(R,E=a(E,I,k,R,x,22,u[15]),I,k,s,5,u[16]);k=f(k,R,E,I,b,9,u[17]);I=f(I,k,R,E,j,14,u[18]);E=f(E,I,k,R,c,20,u[19]);R=f(R,E,I,k,v,5,u[20]);k=f(k,R,E,I,w,9,u[21]);I=f(I,k,R,E,x,14,u[22]);E=f(E,I,k,R,h,20,u[23]);R=f(R,E,I,k,O,5,u[24]);k=f(k,R,E,I,P,9,u[25]);I=f(I,k,R,E,y,14,u[26]);E=f(E,I,k,R,g,20,u[27]);R=f(R,E,I,k,_,5,u[28]);k=f(k,R,E,I,d,9,u[29]);I=f(I,k,R,E,m,14,u[30]);R=l(R,E=f(E,I,k,R,S,20,u[31]),I,k,v,4,u[32]);k=l(k,R,E,I,g,11,u[33]);I=l(I,k,R,E,j,16,u[34]);E=l(E,I,k,R,P,23,u[35]);R=l(R,E,I,k,s,4,u[36]);k=l(k,R,E,I,h,11,u[37]);I=l(I,k,R,E,m,16,u[38]);E=l(E,I,k,R,w,23,u[39]);R=l(R,E,I,k,_,4,u[40]);k=l(k,R,E,I,c,11,u[41]);I=l(I,k,R,E,y,16,u[42]);E=l(E,I,k,R,b,23,u[43]);R=l(R,E,I,k,O,4,u[44]);k=l(k,R,E,I,S,11,u[45]);I=l(I,k,R,E,x,16,u[46]);R=p(R,E=l(E,I,k,R,d,23,u[47]),I,k,c,6,u[48]);k=p(k,R,E,I,m,10,u[49]);I=p(I,k,R,E,P,15,u[50]);E=p(E,I,k,R,v,21,u[51]);R=p(R,E,I,k,S,6,u[52]);k=p(k,R,E,I,y,10,u[53]);I=p(I,k,R,E,w,15,u[54]);E=p(E,I,k,R,s,21,u[55]);R=p(R,E,I,k,g,6,u[56]);k=p(k,R,E,I,x,10,u[57]);I=p(I,k,R,E,b,15,u[58]);E=p(E,I,k,R,_,21,u[59]);R=p(R,E,I,k,h,6,u[60]);k=p(k,R,E,I,j,10,u[61]);I=p(I,k,R,E,d,15,u[62]);E=p(E,I,k,R,O,21,u[63]);i[0]=i[0]+R|0;i[1]=i[1]+E|0;i[2]=i[2]+I|0;i[3]=i[3]+k|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;r[o>>>5]|=128<<24-o%32;var i=t.floor(n/4294967296),c=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);r[14+(o+64>>>9<<4)]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8);e.sigBytes=4*(r.length+1);this._process();for(var u=this._hash,s=u.words,a=0;a<4;a++){var f=s[a];s[a]=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8)}return u},clone:function(){var e=i.clone.call(this);e._hash=this._hash.clone();return e}});function a(e,t,r,n,o,i,c){var u=e+(t&r|~t&n)+o+c;return(u<<i|u>>>32-i)+t}function f(e,t,r,n,o,i,c){var u=e+(t&n|r&~n)+o+c;return(u<<i|u>>>32-i)+t}function l(e,t,r,n,o,i,c){var u=e+(t^r^n)+o+c;return(u<<i|u>>>32-i)+t}function p(e,t,r,n,o,i,c){var u=e+(r^(t|~n))+o+c;return(u<<i|u>>>32-i)+t}r.MD5=i._createHelper(s);r.HmacMD5=i._createHmacHelper(s)}(Math);return e.MD5}(r("../../node_modules/crypto-js/core.js"))},"./src/index.ts":function(e,t,r){"use strict";r.r(t);r.d(t,"MPHTTPRequestEncoder",(function(){return P}));r.d(t,"MPHTTPResponseDecoder",(function(){return x}));r.d(t,"MPHTTPTransport",(function(){return M}));r.d(t,"HighFileSevice",(function(){return $}));r.d(t,"MPServerlessMiniAppCore",(function(){return ae}));var n=r("@alicloud/mpserverless-core"),o=r("../../node_modules/crypto-js/core.js"),i=r.n(o),c=r("../../node_modules/crypto-js/hmac-md5.js"),u=r.n(c),s=Object(n.MPServerlessErrorClass)({UnauthorizedError:{code:"UnauthorizedError",message:"未授权错误"},InterfaceRequestError:{code:"InterfaceRequestError",message:"接口请求错误"}});function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function p(e,t,r){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=S(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){_(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function b(e,t,r){t&&v(e.prototype,t);r&&v(e,r);return e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=S(e);if(t){var o=S(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return w(this,r)}}function w(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?j(e):t}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var P=function(e){m(r,e);var t=O(r);function r(e,o){var i;h(this,r);(i=t.call(this,e)).spaceId=o;_(j(i),"prefix",n.PREFIX.CLIENT);_(j(i),"serviceHeaders",{});i.setBodyField({spaceId:o});return i}b(r,[{key:"sign",value:function(e){var t=this.body,r=t.spaceId,n=t.method,o=t.params,c=t.token,s=t.userId,a=Date.now();this.setBodyField({timestamp:a});var f="",l={spaceId:r,timestamp:a,method:n,params:JSON.stringify(o),token:c,userId:s};Object.keys(l).sort().forEach((function(e){l[e]&&(f="".concat(f,"&").concat(e,"=").concat(l[e]))}));f=f.slice(1);try{var p=u()(f,e).toString(i.a.enc.Hex);this.setServerlessHeaders({sign:p})}catch(e){throw e}}},{key:"encodeAsHTTPRequestObject",value:function(e){this.body.params&&(this.body.params=JSON.stringify(this.body.params));return y({url:this.url,data:this.body,method:this.method,headers:this.headers,dataType:"json"},e)}},{key:"clone",value:function(){var e=new r(this.endpoint,this.spaceId);e.setBodyField(this.body);e.setBaseHeaders(this.baseHeaders);e.setServerlessHeaders(this.serverlessHeaders);return e}}]);return r}(n.HTTPRequestEncoder),x=function(e){m(r,e);var t=O(r);function r(){var e;h(this,r);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];_(j(e=t.call.apply(t,[this].concat(o))),"ERROR_CODES",[11,12,13,14,19,20]);return e}b(r,[{key:"setStatusAndBody",value:function(e,t){p(S(r.prototype),"setStatusAndBody",this).call(this,e,t);this.ERROR_CODES.indexOf(e)>=0&&(this._error=new s.InterfaceRequestError("错误码 ".concat(e.toString(),", 请参考对应开放平台文档排查问题")))}},{key:"decode",value:function(e){this.setHeaders(e.headers||{});var t=e.data||e.body;"string"==typeof t&&(t=JSON.parse(t));if(t&&"data"in t){if(null==t.data)t.result=null;else if(Number(t.data.affectedDocs)===t.data.affectedDocs)t=Object.assign({},t,y({},t.data));else if("[object Object]"===Object.prototype.toString.call(t.data))t.result=Object.assign({},t.data);else if("[object Array]"===Object.prototype.toString.call(t.data)){var n=f(t.data);t.result=n.slice(0)}else t.result=t.data;delete t.data}if(/^request:fail+/.test(e.errMsg)){this.setErrorMessage(e.errMsg);return p(S(r.prototype),"decode",this).call(this)}var o=parseInt(e.error,10);if(o){this.setStatusAndBody(o,t);return p(S(r.prototype),"decode",this).call(this)}var i=e.err;if(i){this.setErrorMessage(i);return p(S(r.prototype),"decode",this).call(this)}if(e instanceof Error){this.setErrorObject(e);return p(S(r.prototype),"decode",this).call(this)}if(t&&"object"===a(t.error)){this.setErrorObject(t.error);return p(S(r.prototype),"decode",this).call(this)}var c=parseInt(e.status||e.statusCode,10);if(c){this.setStatusAndBody(c,t);return p(S(r.prototype),"decode",this).call(this)}this.setStatusAndBody(200,e);return p(S(r.prototype),"decode",this).call(this)}}]);return r}(n.HTTPResponseDecoder);function R(e){return(R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t,r,n,o,i,c){try{var u=e[i](c),s=u.value}catch(e){r(e);return}u.done?t(s):Promise.resolve(s).then(n,o)}function I(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){E(i,n,o,c,u,"next",e)}function u(e){E(i,n,o,c,u,"throw",e)}c(void 0)}))}}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function A(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=D(e);if(t){var o=D(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return q(this,r)}}function q(e,t){return!t||"object"!==R(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function H(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var M=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&T(e,t)}(r,e);var t=A(r);function r(e){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);H(B(n=t.call(this,e)),"userService",void 0);H(B(n),"httpRequest",void 0);return n}!function(e,t,r){t&&k(e.prototype,t);r&&k(e,r)}(r,[{key:"setUserService",value:function(e){this.userService=e}},{key:"setRequest",value:function(e){Object(n.assert)(e,"初始化时缺少 request 参数");this.httpRequest=e}},{key:"getEncoder",value:function(e){return new P(this.endpoint,this.spaceId)}},{key:"request",value:function(){var e=I(regeneratorRuntime.mark((function e(t){var r,n,o,i,c,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=u.length>1&&void 0!==u[1]&&u[1];n=t.clone();e.next=4;return this.userService.setRequestToken(t,r);case 4:o=e.sent;this.ua&&o.setBaseHeaders({"x-serverless-ua":this.ua});e.prev=6;i=o.encodeAsHTTPRequestObject({timeout:this.timeout,dataType:"json"});this.logger.info("request encode data",i);e.next=11;return this.httpRequest(i);case 11:c=e.sent;return e.abrupt("return",c);case 15:e.prev=15;e.t0=e.catch(6);this.logger.error("request error",e.t0);if(!("GATEWAY_INVALID_TOKEN"===e.t0.error.code||"InvalidParameter.InvalidToken"===e.t0.error.code)){e.next=25;break}if(!r){e.next=22;break}throw new s.UnauthorizedError("授权 token 已过期，重新获取失败");case 22:e.next=24;return this.request(n,!0);case 24:return e.abrupt("return",e.sent);case 25:if(!e.t0.error){e.next=27;break}throw e.t0.error;case 27:throw e.t0;case 28:case"end":return e.stop()}}),e,this,[[6,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"wrapApi",value:function(e){var t=this;return function(){var r=I(regeneratorRuntime.mark((function r(n){var o,i,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.next=2;return e(n);case 2:o=r.sent;t.logger.info("completed request");t.logger.info(JSON.stringify(o,null,2));i=new x;if(!(c=i.decode(o)).error){r.next=9;break}throw c;case 9:return r.abrupt("return",c);case 10:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()}}]);return r}(n.HTTPTransport);function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t,r,n,o,i,c){try{var u=e[i](c),s=u.value}catch(e){r(e);return}u.done?t(s):Promise.resolve(s).then(n,o)}function U(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function C(e,t,r){return(C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=W(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function K(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=W(e);if(t){var o=W(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return J(this,r)}}function J(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?L(e):t}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&N(e,t)}(r,e);var t=K(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(L(i=t.call(this,e,o)),"getFileUploadInfo",void 0);Object(n.assert)(o.getFileUploadInfo,"[MPFileService]初始化时缺少 getFileUploadInfo 参数");i.getFileUploadInfo=o.getFileUploadInfo;return i}!function(e,t,r){t&&U(e.prototype,t);r&&U(e,r)}(r,[{key:"uploadFile",value:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function c(e){z(i,n,o,c,u,"next",e)}function u(e){z(i,n,o,c,u,"throw",e)}c(void 0)}))}}(regeneratorRuntime.mark((function e(t){var o,i,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object(n.assert)(t,"options required");Object(n.assert)(t.filePath&&"string"==typeof t.filePath,"[MPFileService]调用 uploadFile 缺少 filePath 参数");e.next=4;return this.getFileUploadInfo({filePath:t.filePath});case 4:o=e.sent;i=o.body,c=i.fileSize,u=i.fileExtension;!t.fileSize&&c&&(t.fileSize=c);!t.extension&&u&&(t.extension=u);"string"==typeof t.fileSize&&(t.fileSize=parseInt(t.fileSize));e.next=11;return C(W(r.prototype),"uploadFile",this).call(this,t);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]);return r}(r("@alicloud/mp-file-service").MPFileService),G=r("@alicloud/mp-proxy-service"),V=r("@alicloud/mp-db-service"),X=r("@alicloud/mp-user-service"),Y=r("@alicloud/mp-function-service");function Q(e){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})));r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){se(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1;n.configurable=!0;"value"in n&&(n.writable=!0);Object.defineProperty(e,n.key,n)}}function re(e,t,r){return(re="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ue(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function ne(e,t){return(ne=Object.setPrototypeOf||function(e,t){e.__proto__=t;return e})(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return!0}catch(e){return!1}}();return function(){var r,n=ue(e);if(t){var o=ue(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return ie(this,r)}}function ie(e,t){return!t||"object"!==Q(t)&&"function"!=typeof t?ce(e):t}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}var ae=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}});t&&ne(e,t)}(r,e);var t=oe(r);function r(e,o){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);se(ce(i=t.call(this,ee(ee({},o),{},{httpTransport:M,options:e.logger}))),"db",void 0);se(ce(i),"file",void 0);se(ce(i),"user",void 0);se(ce(i),"function",void 0);se(ce(i),"network",void 0);Object(n.assert)(o.clientSecret,"clientSecret is required");Object(n.assert)(o.appId,"appId is required");i.user=new X.UserService(i.transport,{getAuthCode:i.transport.wrapApi(e.getAuthCode),request:i.transport.wrapApi(e.request),appId:o.appId,appSecret:o.clientSecret,isvAppId:o.isvAppId,ua:i.ua});i.transport.setUserService(i.user);i.transport.setRequest(i.transport.wrapApi(e.request));i.db=new V.DbService(i.transport);i.file=new $(i.transport,{uploadFile:i.transport.wrapApi(e.uploadFile),getFileUploadInfo:i.transport.wrapApi(e.getFileUploadInfo)});i.function=new Y.FunctionService(i.transport);i.network=new G.ProxyService(i.transport);return i}!function(e,t,r){t&&te(e.prototype,t);r&&te(e,r)}(r,[{key:"createTransport",value:function(e){re(ue(r.prototype),"createTransport",this).call(this,e);this.transport.setAppSecret(e.clientSecret).setUA(this.ua)}},{key:"version",get:function(){return VERSION}},{key:"ua",get:function(){return PKGUA}}]);return r}(n.MPServerlessCore)},"@alicloud/mp-db-service":function(t,r){t.exports=e},"@alicloud/mp-file-service":function(e,r){e.exports=t},"@alicloud/mp-function-service":function(e,t){e.exports=r},"@alicloud/mp-proxy-service":function(e,t){e.exports=n},"@alicloud/mp-user-service":function(e,t){e.exports=o},"@alicloud/mpserverless-core":function(e,t){e.exports=i}})}));